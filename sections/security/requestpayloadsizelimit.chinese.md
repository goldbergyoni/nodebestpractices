# ä½¿ç”¨åå‘ä»£ç†æˆ–ä¸­é—´ä»¶é™åˆ¶è´Ÿè½½å¤§å°

### ä¸€æ®µè§£é‡Š

è§£æè¯·æ±‚æ­£æ–‡ï¼ˆä¾‹å¦‚ JSON ç¼–ç çš„payloadsï¼‰æ˜¯ä¸€é¡¹æ€§èƒ½ç¹é‡çš„æ“ä½œï¼Œå°¤å…¶æ˜¯å¯¹äºè¾ƒå¤§çš„è¯·æ±‚ã€‚
åœ¨æ‚¨çš„ Web åº”ç”¨ç¨‹åºä¸­å¤„ç†ä¼ å…¥è¯·æ±‚æ—¶ï¼Œæ‚¨åº”è¯¥é™åˆ¶å…¶å„è‡ªæœ‰æ•ˆè´Ÿè½½çš„å¤§å°ã€‚ä¼ å…¥è¯·æ±‚ç”±äºæ‹’ç»æœåŠ¡ä¸­æ–­æˆ–å…¶ä»–ä¸éœ€è¦çš„å‰¯ä½œç”¨ï¼Œæ— é™çš„ä¸»ä½“/æœ‰æ•ˆè´Ÿè½½å¤§å°å¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„åº”ç”¨ç¨‹åºæ€§èƒ½ä¸ä½³æˆ–å´©æºƒã€‚
è®¸å¤šæµè¡Œçš„è§£æè¯·æ±‚ä½“çš„ä¸­é—´ä»¶è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚å·²ç»åŒ…å«çš„ç”¨äº express çš„ `body-parser` åŒ…ï¼Œæš´éœ²äº†é™åˆ¶è¯·æ±‚æœ‰æ•ˆè´Ÿè½½å¤§å°çš„é€‰é¡¹ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥è½»æ¾å®ç°æ­¤åŠŸèƒ½ã€‚å¦‚æœæ”¯æŒï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æ‚¨çš„åå‘ä»£ç†/ç½‘ç»œæœåŠ¡å™¨è½¯ä»¶ä¸­é›†æˆè¯·æ±‚æ­£æ–‡å¤§å°é™åˆ¶ã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨é™åˆ¶è¯·æ±‚å¤§å°çš„ç¤ºä¾‹ `express` å’Œ/æˆ– `nginx`ã€‚

### `express` çš„ç¤ºä¾‹ä»£ç 

```javascript
const express = require('express');

const app = express();

app.use(express.json({ limit: '300kb' })); // body-parser é»˜è®¤çš„ body å¤§å°é™åˆ¶ä¸º 100kb

// ä½¿ç”¨ json è¯·æ±‚
app.post('/json', (req, res) => {

    // æ£€æŸ¥è¯·æ±‚å†…å®¹ç±»å‹æ˜¯å¦ä¸ json åŒ¹é…ï¼Œå› ä¸º body-parser ä¸æ£€æŸ¥å†…å®¹ç±»å‹
    if (!req.is('json')) {
        return res.sendStatus(415); // -> å¦‚æœè¯·æ±‚æ²¡æœ‰ JSON æ­£æ–‡ï¼Œåˆ™è¿”å›ä¸æ”¯æŒçš„åª’ä½“ç±»å‹
    }

    res.send('Hooray, it worked!');
});

app.listen(3000, () => console.log('Example app listening on port 3000!'));
```

ğŸ”— [**Express express.json()æ–‡æ¡£**](http://expressjs.com/en/4x/api.html#express.json)

### `nginx` çš„ç¤ºä¾‹é…ç½®

```nginx
http {
    ...
    # å°†æ‰€æœ‰ä¼ å…¥è¯·æ±‚çš„æ­£æ–‡å¤§å°é™åˆ¶ä¸º 1 MB
    client_max_body_size 1m;
}

server {
    ...
    # å°†æ­¤ç‰¹å®šæœåŠ¡å™¨å—çš„ä¼ å…¥è¯·æ±‚çš„æ­£æ–‡å¤§å°é™åˆ¶ä¸º 1 MB
    client_max_body_size 1m;
}

location /upload {
    ...
    # å°†æ­¤è·¯ç”±çš„ä¼ å…¥è¯·æ±‚çš„æ­£æ–‡å¤§å°é™åˆ¶ä¸º 1 MB
    client_max_body_size 1m;
}
```

ğŸ”— [**Nginx client_max_body_sizeæ–‡æ¡£ **](http://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size)